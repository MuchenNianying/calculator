<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3118993972529320">
    <title>多功能计算器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: #f8f9fa;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .calculator-section {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .calculator-section.active {
            display: block;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .grid-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .grid-buttons button {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            height: 60px;
        }

        .grid-buttons button:hover {
            background: #667eea;
            color: white;
        }

        .scientific-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .scientific-buttons button {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            height: 50px;
        }

        .scientific-buttons button:hover {
            background: #667eea;
            color: white;
        }

        .converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .converter-item {
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .converter-item h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .mortgage-calculator {
            max-width: 600px;
            margin: 0 auto;
        }

        .tax-calculator {
            max-width: 700px;
            margin: 0 auto;
        }

        .binary-converter {
            max-width: 500px;
            margin: 0 auto;
        }

        .bmi-calculator {
            max-width: 500px;
            margin: 0 auto;
        }

        .tax-deduction-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .tax-deduction-item input[type="checkbox"] {
            margin-right: 10px;
            margin-left: 0;
            width: 50px; /* 固定宽度50px */
        }

        .tax-deduction-item input[type="number"] {
            width: 100px;
            margin-left: 10px;
        }

        .currency-loading {
            text-align: center;
            padding: 10px;
            color: #666;
        }

        .tax-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .tax-option {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tax-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tax-notes {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .tax-notes h3 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .tax-notes table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .tax-notes table th, .tax-notes table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .tax-notes table th {
            background-color: #f2f2f2;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            .grid-buttons {
                grid-template-columns: repeat(3, 1fr);
            }

            .scientific-buttons {
                grid-template-columns: repeat(3, 1fr);
            }

            .converter-grid {
                grid-template-columns: 1fr;
            }

            .tax-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>多功能计算器</h1>
        <p>包含普通计算、科学计算、各种转换功能</p>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showSection('basic')">普通计算器</button>
        <button class="nav-tab" onclick="showSection('scientific')">科学计算器</button>
        <button class="nav-tab" onclick="showSection('currency')">汇率转换</button>
        <button class="nav-tab" onclick="showSection('mortgage')">房贷计算</button>
        <button class="nav-tab active" onclick="showSection('tax')">个税计算</button>
        <button class="nav-tab" onclick="showSection('chineseNumber')">大写数字</button>
        <button class="nav-tab" onclick="showSection('conversions')">单位转换</button>
        <button class="nav-tab" onclick="showSection('advanced')">程序员工具</button>
        <button class="nav-tab" onclick="showSection('bmi')">BMI计算器</button>
    </div>

    <div id="basic" class="calculator-section">
        <h2>普通计算器</h2>
        <div class="input-group">
            <input type="text" id="display" readonly style="text-align: right; font-size: 24px; height: 60px;">
        </div>
        <div class="grid-buttons">
            <button onclick="clearDisplay()">C</button>
            <button onclick="deleteLast()">←</button>
            <button onclick="appendToDisplay('%')">%</button>
            <button onclick="appendToDisplay('/')">÷</button>

            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button onclick="appendToDisplay('*')">×</button>

            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button onclick="appendToDisplay('-')">-</button>

            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button onclick="appendToDisplay('+')">+</button>

            <button onclick="appendToDisplay('0')" style="grid-column: span 2;">0</button>
            <button onclick="appendToDisplay('.')">.</button>
            <button onclick="calculate()" style="background: #28a745; color: white;">=</button>
        </div>
    </div>

    <div id="scientific" class="calculator-section">
        <h2>科学计算器</h2>
        <div class="input-group">
            <input type="text" id="scientificDisplay" readonly style="text-align: right; font-size: 24px; height: 60px;">
        </div>
        <div class="scientific-buttons">
            <button onclick="appendToScientific('sin(')">sin</button>
            <button onclick="appendToScientific('cos(')">cos</button>
            <button onclick="appendToScientific('tan(')">tan</button>
            <button onclick="appendToScientific('log(')">log</button>
            <button onclick="appendToScientific('ln(')">ln</button>

            <button onclick="appendToScientific('π')">π</button>
            <button onclick="appendToScientific('e')">e</button>
            <button onclick="appendToScientific('^')">x^y</button>
            <button onclick="appendToScientific('√(')">√</button>
            <button onclick="appendToScientific('!')">x!</button>

            <button onclick="appendToScientific('(')">(</button>
            <button onclick="appendToScientific(')')">)</button>
            <button onclick="appendToScientific('7')">7</button>
            <button onclick="appendToScientific('8')">8</button>
            <button onclick="appendToScientific('9')">9</button>

            <button onclick="appendToScientific('4')">4</button>
            <button onclick="appendToScientific('5')">5</button>
            <button onclick="appendToScientific('6')">6</button>
            <button onclick="appendToScientific('*')">×</button>
            <button onclick="appendToScientific('/')">÷</button>

            <button onclick="appendToScientific('1')">1</button>
            <button onclick="appendToScientific('2')">2</button>
            <button onclick="appendToScientific('3')">3</button>
            <button onclick="appendToScientific('+')">+</button>
            <button onclick="appendToScientific('-')">-</button>

            <button onclick="appendToScientific('0')">0</button>
            <button onclick="appendToScientific('.')">.</button>
            <button onclick="clearScientific()">C</button>
            <button onclick="calculateScientific()" style="background: #28a745; color: white;">=</button>
            <button onclick="deleteLastScientific()">←</button>
        </div>
    </div>

    <div id="currency" class="calculator-section">
        <h2>汇率转换</h2>
        <div class="input-group">
            <label>金额</label>
            <input type="number" id="currencyAmount" placeholder="输入金额">
        </div>
        <div class="input-group">
            <label>从</label>
            <select id="fromCurrency">
                <option value="CNY">人民币 (CNY)</option>
            </select>
        </div>
        <div class="input-group">
            <label>到</label>
            <select id="toCurrency">
                <option value="USD">美元 (USD)</option>
            </select>
        </div>
        <button class="btn" onclick="convertCurrency()">转换</button>
        <div id="currencyResult" class="result" style="display: none;"></div>
        <div id="currencyLoading" class="currency-loading" style="display: none;">加载汇率数据中...</div>
    </div>

    <div id="mortgage" class="calculator-section mortgage-calculator">
        <h2>房贷计算</h2>
        <div class="input-group">
            <label>贷款总额 (万元)</label>
            <input type="number" id="loanAmount" placeholder="例如: 100">
        </div>
        <div class="input-group">
            <label>年利率 (%)</label>
            <input type="number" id="interestRate" step="0.01" placeholder="例如: 4.9">
        </div>
        <div class="input-group">
            <label>贷款年限</label>
            <input type="number" id="loanYears" placeholder="例如: 30">
        </div>
        <div class="input-group">
            <label>还款方式</label>
            <select id="repaymentType">
                <option value="equal">等额本息</option>
                <option value="decreasing">等额本金</option>
            </select>
        </div>
        <button class="btn" onclick="calculateMortgage()">计算</button>
        <div id="mortgageResult" class="result" style="display: none;"></div>
    </div>

    <div id="tax" class="calculator-section tax-calculator active">
        <h2>个税计算</h2>
        <div class="tax-options">
            <div class="tax-option active" onclick="switchTaxMode('salary')">工资薪金</div>
            <div class="tax-option" onclick="switchTaxMode('bonus')">年终奖</div>
        </div>

        <div id="salaryTax" style="display: block;">
            <div class="input-group">
                <label>月收入 (元)</label>
                <input type="number" id="monthlyIncome" placeholder="例如: 10000">
            </div>
            <div class="input-group">
                <label>当前月份</label>
                <select id="currentMonth">
                    <option value="1">1月</option>
                    <option value="2">2月</option>
                    <option value="3">3月</option>
                    <option value="4">4月</option>
                    <option value="5">5月</option>
                    <option value="6">6月</option>
                    <option value="7">7月</option>
                    <option value="8">8月</option>
                    <option value="9">9月</option>
                    <option value="10">10月</option>
                    <option value="11">11月</option>
                    <option value="12">12月</option>
                </select>
            </div>
            <h3>专项附加扣除</h3>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="childEdu" onchange="updateDeductionAmount('childEdu', 2000)">
                    <label for="childEdu">子女教育</label>
                    <input type="number" id="childEduAmount" value="2000" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="continueEdu" onchange="updateDeductionAmount('continueEdu', 400)">
                    <label for="continueEdu">继续教育</label>
                    <input type="number" id="continueEduAmount" value="400" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="medical" onchange="updateDeductionAmount('medical', 0)">
                    <label for="medical">大病医疗</label>
                    <input type="number" id="medicalAmount" value="0" min="0" max="80000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="mortgageInterest" onchange="updateDeductionAmount('mortgageInterest', 1000)">
                    <label for="mortgageInterest">住房贷款利息</label>
                    <input type="number" id="mortgageInterestAmount" value="1000" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="rent" onchange="updateDeductionAmount('rent', 1500)">
                    <label for="rent">住房租金</label>
                    <input type="number" id="rentAmount" value="1500" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="supportElderly" onchange="updateDeductionAmount('supportElderly', 2000)">
                    <label for="supportElderly">赡养老人</label>
                    <input type="number" id="supportElderlyAmount" value="2000" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <div class="input-group">
                <div class="tax-deduction-item">
                    <input type="checkbox" id="infantCare" onchange="updateDeductionAmount('infantCare', 2000)">
                    <label for="infantCare">0-3岁婴幼儿照护</label>
                    <input type="number" id="infantCareAmount" value="2000" min="0" max="10000" style="width: 80px;">
                </div>
            </div>
            <h3>五险一金扣除</h3>
            <div class="input-group">
                <label>公积金比例 (%)</label>
                <input type="number" id="housingFundRate" placeholder="例如: 8" value="8" min="0" max="100">
            </div>
            <div class="input-group">
                <label>医疗比例 (%)</label>
                <input type="number" id="medicalRate" placeholder="例如: 2" value="2" min="0" max="100">
            </div>
            <div class="input-group">
                <label>养老比例 (%)</label>
                <input type="number" id="pensionRate" placeholder="例如: 8" value="8" min="0" max="100">
            </div>
            <div class="input-group">
                <label>失业比例 (%)</label>
                <input type="number" id="unemploymentRate" placeholder="例如: 0.5" value="0.5" min="0" max="100">
            </div>
            <div class="input-group">
                <label>工伤比例 (%)</label>
                <input type="number" id="injuryRate" placeholder="例如: 0" value="0" min="0" max="100">
            </div>
            <div class="input-group">
                <label>生育比例 (%)</label>
                <input type="number" id="maternityRate" placeholder="例如: 0" value="0" min="0" max="100">
            </div>
        </div>

        <div id="bonusTax" style="display: none;">
            <div class="input-group">
                <label>年终奖金 (元)</label>
                <input type="number" id="annualBonus" placeholder="例如: 50000">
            </div>
            <div class="input-group">
                <label>选择计税方式</label>
                <select id="bonusTaxMethod">
                    <option value="separate">单独计税</option>
                    <option value="combined">并入当年综合所得计税</option>
                </select>
            </div>
        </div>

        <button class="btn" onclick="calculateTax()">计算个税</button>
        <div id="taxResult" class="result" style="display: none;"></div>

        <!-- 工资薪金页面备注信息 -->
        <div id="salaryNotes" class="tax-notes">
            <h3>工资薪金收入个税</h3>
            <p>工资、薪金所得，是指个人因任职或受雇而取得的工资、薪金、奖金、年终加薪、劳动分红、津贴、补贴以及与任职或受雇有关的其他所得。</p>

            <h3>工资个税预扣预缴计算公式</h3>
            <p>当月个税 = （累计收入 - 累计五险一金 - 累计专项附加扣除 - 累计减除费用）× 预扣税率 - 速算扣除数 - 累计已缴纳税额<br>
                应纳税所得额 = 累计税前工资收入 - 累计五险一金（个人缴纳部分） - 累计专项附加扣除 - 累计减除费用<br>
                累计应纳税额 = 应纳税所得额 × 税率 - 速算扣除数<br>
                当月应纳税额 = 累计应纳税额 - 累计已缴纳税额<br>
                累计减除费用 = 员工当年在职月数 × 5000</p>

            <h3>2020年最新个人所得税税率表</h3>
            <table>
                <tr>
                    <th>级数</th>
                    <th>累计预扣预缴应纳税所得额</th>
                    <th>预扣税率</th>
                    <th>速算扣除数</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>不超过36000元的部分</td>
                    <td>3%</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>超过36000元至144000元的部分</td>
                    <td>10%</td>
                    <td>2520</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>超过144000元至300000元的部分</td>
                    <td>20%</td>
                    <td>16920</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>超过300000元至420000元的部分</td>
                    <td>25%</td>
                    <td>31920</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>超过420000元至660000元的部分</td>
                    <td>30%</td>
                    <td>52920</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>超过660000元至960000元的部分</td>
                    <td>35%</td>
                    <td>85920</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>超过960000元的部分</td>
                    <td>45%</td>
                    <td>181920</td>
                </tr>
            </table>
        </div>

        <!-- 年终奖页面备注信息 -->
        <div id="bonusNotes" class="tax-notes" style="display: none;">
            <h3>个人所得税计算公式</h3>
            <p>（一）先将雇员当月内取得的全年一次性奖金，除以12个月，按其商数（平均每月收入），参照下面的个税税率表，确定适用税率和速算扣除数。<br>
                （二）将雇员个人当月内取得的全年一次性奖金，按上述确定的适用税率和速算扣除数计算征税，计算公式如下：<br>
                应纳税额=雇员当月取得全年一次性奖金×适用税率-速算扣除数</p>

            <h3>年终奖个税税率表</h3>
            <table>
                <tr>
                    <th>级数</th>
                    <th>累计预扣预缴应纳税所得额</th>
                    <th>预扣税率</th>
                    <th>速算扣除数</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>不超过3000元的部分</td>
                    <td>3%</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>超过3000元至12000元的部分</td>
                    <td>10%</td>
                    <td>210</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>超过12000元至25000元的部分</td>
                    <td>20%</td>
                    <td>1410</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>超过25000元至35000元的部分</td>
                    <td>25%</td>
                    <td>2660</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>超过35000元至55000元的部分</td>
                    <td>30%</td>
                    <td>4410</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>超过55000元至80000元的部分</td>
                    <td>35%</td>
                    <td>7160</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>超过80000元的部分</td>
                    <td>45%</td>
                    <td>15160</td>
                </tr>
            </table>
        </div>
    </div>

    <div id="chineseNumber" class="calculator-section">
        <h2>大写数字转换</h2>
        <div class="input-group">
            <label>输入金额</label>
            <input type="number" id="numberInput" placeholder="输入金额" step="0.01">
        </div>
        <button class="btn" onclick="convertToChineseNumber()">转换为大写</button>
        <div id="chineseNumberResult" class="result" style="display: none;"></div>
    </div>

    <div id="conversions" class="calculator-section">
        <h2>单位转换</h2>
        <div class="converter-grid">
            <div class="converter-item">
                <h3>长度转换</h3>
                <div class="input-group">
                    <input type="number" id="lengthValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="lengthFrom">
                        <option value="mm">毫米 (mm)</option>
                        <option value="cm">厘米 (cm)</option>
                        <option value="m">米 (m)</option>
                        <option value="km">千米 (km)</option>
                        <option value="in">英寸 (in)</option>
                        <option value="ft">英尺 (ft)</option>
                        <option value="yd">码 (yd)</option>
                        <option value="mi">英里 (mi)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="lengthTo">
                        <option value="m">米 (m)</option>
                        <option value="mm">毫米 (mm)</option>
                        <option value="cm">厘米 (cm)</option>
                        <option value="km">千米 (km)</option>
                        <option value="in">英寸 (in)</option>
                        <option value="ft">英尺 (ft)</option>
                        <option value="yd">码 (yd)</option>
                        <option value="mi">英里 (mi)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertLength()">转换</button>
                <div id="lengthResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>面积转换</h3>
                <div class="input-group">
                    <input type="number" id="areaValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="areaFrom">
                        <option value="sqm">平方米 (m²)</option>
                        <option value="sqcm">平方厘米 (cm²)</option>
                        <option value="sqkm">平方千米 (km²)</option>
                        <option value="acre">英亩 (acre)</option>
                        <option value="hectare">公顷 (ha)</option>
                        <option value="sqft">平方英尺 (ft²)</option>
                        <option value="sqin">平方英寸 (in²)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="areaTo">
                        <option value="sqm">平方米 (m²)</option>
                        <option value="sqcm">平方厘米 (cm²)</option>
                        <option value="sqkm">平方千米 (km²)</option>
                        <option value="acre">英亩 (acre)</option>
                        <option value="hectare">公顷 (ha)</option>
                        <option value="sqft">平方英尺 (ft²)</option>
                        <option value="sqin">平方英寸 (in²)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertArea()">转换</button>
                <div id="areaResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>体积转换</h3>
                <div class="input-group">
                    <input type="number" id="volumeValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="volumeFrom">
                        <option value="ml">毫升 (ml)</option>
                        <option value="l">升 (L)</option>
                        <option value="m3">立方米 (m³)</option>
                        <option value="gal">加仑 (gal)</option>
                        <option value="pt">品脱 (pt)</option>
                        <option value="qt">夸脱 (qt)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="volumeTo">
                        <option value="l">升 (L)</option>
                        <option value="ml">毫升 (ml)</option>
                        <option value="m3">立方米 (m³)</option>
                        <option value="gal">加仑 (gal)</option>
                        <option value="pt">品脱 (pt)</option>
                        <option value="qt">夸脱 (qt)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertVolume()">转换</button>
                <div id="volumeResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>重量转换</h3>
                <div class="input-group">
                    <input type="number" id="weightValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="weightFrom">
                        <option value="g">克 (g)</option>
                        <option value="kg">千克 (kg)</option>
                        <option value="t">吨 (t)</option>
                        <option value="lb">磅 (lb)</option>
                        <option value="oz">盎司 (oz)</option>
                        <option value="st">英石 (st)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="weightTo">
                        <option value="kg">千克 (kg)</option>
                        <option value="g">克 (g)</option>
                        <option value="t">吨 (t)</option>
                        <option value="lb">磅 (lb)</option>
                        <option value="oz">盎司 (oz)</option>
                        <option value="st">英石 (st)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertWeight()">转换</button>
                <div id="weightResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>温度转换</h3>
                <div class="input-group">
                    <input type="number" id="tempValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="tempFrom">
                        <option value="celsius">摄氏度 (°C)</option>
                        <option value="fahrenheit">华氏度 (°F)</option>
                        <option value="kelvin">开尔文 (K)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="tempTo">
                        <option value="fahrenheit">华氏度 (°F)</option>
                        <option value="celsius">摄氏度 (°C)</option>
                        <option value="kelvin">开尔文 (K)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertTemperature()">转换</button>
                <div id="tempResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>压强转换</h3>
                <div class="input-group">
                    <input type="number" id="pressureValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="pressureFrom">
                        <option value="pa">帕斯卡 (Pa)</option>
                        <option value="kpa">千帕 (kPa)</option>
                        <option value="mpa">兆帕 (MPa)</option>
                        <option value="bar">巴 (bar)</option>
                        <option value="psi">磅/平方英寸 (psi)</option>
                        <option value="atm">标准大气压 (atm)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="pressureTo">
                        <option value="kpa">千帕 (kPa)</option>
                        <option value="pa">帕斯卡 (Pa)</option>
                        <option value="mpa">兆帕 (MPa)</option>
                        <option value="bar">巴 (bar)</option>
                        <option value="psi">磅/平方英寸 (psi)</option>
                        <option value="atm">标准大气压 (atm)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertPressure()">转换</button>
                <div id="pressureResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>时间转换</h3>
                <div class="input-group">
                    <input type="number" id="timeValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="timeFrom">
                        <option value="ms">毫秒</option>
                        <option value="s">秒</option>
                        <option value="min">分钟</option>
                        <option value="h">小时</option>
                        <option value="d">天</option>
                        <option value="wk">周</option>
                        <option value="mo">月</option>
                        <option value="y">年</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="timeTo">
                        <option value="s">秒</option>
                        <option value="ms">毫秒</option>
                        <option value="min">分钟</option>
                        <option value="h">小时</option>
                        <option value="d">天</option>
                        <option value="wk">周</option>
                        <option value="mo">月</option>
                        <option value="y">年</option>
                    </select>
                </div>
                <button class="btn" onclick="convertTime()">转换</button>
                <div id="timeResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>速度转换</h3>
                <div class="input-group">
                    <input type="number" id="speedValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="speedFrom">
                        <option value="mps">米/秒 (m/s)</option>
                        <option value="kmh">千米/小时 (km/h)</option>
                        <option value="mph">英里/小时 (mph)</option>
                        <option value="knot">节 (knot)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="speedTo">
                        <option value="kmh">千米/小时 (km/h)</option>
                        <option value="mps">米/秒 (m/s)</option>
                        <option value="mph">英里/小时 (mph)</option>
                        <option value="knot">节 (knot)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertSpeed()">转换</button>
                <div id="speedResult" class="result" style="display: none;"></div>
            </div>

            <div class="converter-item">
                <h3>功率转换</h3>
                <div class="input-group">
                    <input type="number" id="powerValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="powerFrom">
                        <option value="w">瓦特 (W)</option>
                        <option value="kw">千瓦 (kW)</option>
                        <option value="hp">马力 (hp)</option>
                        <option value="ps">公制马力 (PS)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="powerTo">
                        <option value="kw">千瓦 (kW)</option>
                        <option value="w">瓦特 (W)</option>
                        <option value="hp">马力 (hp)</option>
                        <option value="ps">公制马力 (PS)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertPower()">转换</button>
                <div id="powerResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div id="advanced" class="calculator-section">
        <h2>程序员常用工具</h2>
        <div class="converter-grid">
            <div class="converter-item">
                <h3>进制转换</h3>
                <div class="binary-converter">
                    <div class="input-group">
                        <input type="text" id="binaryInput" placeholder="输入数字">
                    </div>
                    <div class="input-group">
                        <label>从进制</label>
                        <select id="fromBase">
                            <option value="2">二进制</option>
                            <option value="8">八进制</option>
                            <option value="10">十进制</option>
                            <option value="16">十六进制</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>到进制</label>
                        <select id="toBase">
                            <option value="10">十进制</option>
                            <option value="2">二进制</option>
                            <option value="8">八进制</option>
                            <option value="16">十六进制</option>
                        </select>
                    </div>
                    <button class="btn" onclick="convertBase()">转换</button>
                    <div id="baseResult" class="result" style="display: none;"></div>
                </div>
            </div>

            <div class="converter-item">
                <h3>数据转换</h3>
                <div class="input-group">
                    <input type="number" id="dataValue" placeholder="输入数值">
                </div>
                <div class="input-group">
                    <select id="dataFrom">
                        <option value="B">字节 (B)</option>
                        <option value="KB">千字节 (KB)</option>
                        <option value="MB">兆字节 (MB)</option>
                        <option value="GB">吉字节 (GB)</option>
                        <option value="TB">太字节 (TB)</option>
                        <option value="PB">拍字节 (PB)</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="dataTo">
                        <option value="MB">兆字节 (MB)</option>
                        <option value="B">字节 (B)</option>
                        <option value="KB">千字节 (KB)</option>
                        <option value="GB">吉字节 (GB)</option>
                        <option value="TB">太字节 (TB)</option>
                        <option value="PB">拍字节 (PB)</option>
                    </select>
                </div>
                <button class="btn" onclick="convertData()">转换</button>
                <div id="dataResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div id="bmi" class="calculator-section bmi-calculator">
        <h2>BMI计算器</h2>
        <div class="input-group">
            <label>身高 (cm)</label>
            <input type="number" id="height" placeholder="例如: 175">
        </div>
        <div class="input-group">
            <label>体重 (kg)</label>
            <input type="number" id="weight" placeholder="例如: 70">
        </div>
        <button class="btn" onclick="calculateBMI()">计算BMI</button>
        <div id="bmiResult" class="result" style="display: none;"></div>
    </div>
</div>

<script>
    // 汇率数据存储
    let exchangeRates = {};
    let currencyOptions = [];

    // 基本计算器缓存功能
    let basicCalculatorHistory = [];
    function appendToDisplay(value) {
        document.getElementById('display').value += value;
    }

    function clearDisplay() {
        document.getElementById('display').value = '';
    }

    function deleteLast() {
        let display = document.getElementById('display');
        display.value = display.value.slice(0, -1);
    }

    function calculate() {
        try {
            let expression = document.getElementById('display').value;
            expression = expression.replace(/×/g, '*').replace(/÷/g, '/');
            let result = eval(expression);
            document.getElementById('display').value = result;

            // 添加到历史记录
            basicCalculatorHistory.push({
                expression: expression,
                result: result,
                timestamp: new Date()
            });
        } catch (error) {
            document.getElementById('display').value = '错误';
        }
    }

    // 科学计算器功能
    function appendToScientific(value) {
        if (value === 'π') value = Math.PI.toString();
        else if (value === 'e') value = Math.E.toString();
        document.getElementById('scientificDisplay').value += value;
    }

    function clearScientific() {
        document.getElementById('scientificDisplay').value = '';
    }

    function deleteLastScientific() {
        let display = document.getElementById('scientificDisplay');
        display.value = display.value.slice(0, -1);
    }

    function calculateScientific() {
        try {
            let expression = document.getElementById('scientificDisplay').value;
            expression = expression.replace(/sin\(/g, 'Math.sin(');
            expression = expression.replace(/cos\(/g, 'Math.cos(');
            expression = expression.replace(/tan\(/g, 'Math.tan(');
            expression = expression.replace(/log\(/g, 'Math.log10(');
            expression = expression.replace(/ln\(/g, 'Math.log(');
            expression = expression.replace(/√\(/g, 'Math.sqrt(');
            expression = expression.replace(/\^/g, '**');

            expression = expression.replace(/(\d+)!/g, function(match, num) {
                return factorial(parseInt(num));
            });

            let result = eval(expression);
            document.getElementById('scientificDisplay').value = result;
        } catch (error) {
            document.getElementById('scientificDisplay').value = '错误';
        }
    }

    function factorial(n) {
        if (n === 0 || n === 1) return 1;
        let result = 1;
        for (let i = 2; i <= n; i++) {
            result *= i;
        }
        return result;
    }

    // 汇率转换功能 - 使用代理解决CORS问题
    async function loadExchangeRates() {
        document.getElementById('currencyLoading').style.display = 'block';
        try {
            // 使用代理服务器解决CORS问题
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            const apiUrl = 'https://yunapi.cn/api/huilv';
            const response = await fetch(proxyUrl + encodeURIComponent(apiUrl));
            if (!response.ok) {
                throw new Error('网络请求失败');
            }
            exchangeRates = await response.json();

            // 如果CNY不在汇率数据中，设置默认值为1
            if (!exchangeRates['CNY']) {
                exchangeRates['CNY'] = 1;
            }

            // 更新下拉选项
            updateCurrencyOptions();

            // 显示汇率数据已加载
            document.getElementById('currencyLoading').innerHTML = '汇率数据已加载';
            setTimeout(() => {
                document.getElementById('currencyLoading').style.display = 'none';
            }, 1000);
        } catch (error) {
            console.error('获取汇率数据失败:', error);
            document.getElementById('currencyLoading').innerHTML = '汇率数据加载失败，请稍后重试';
            setTimeout(() => {
                document.getElementById('currencyLoading').style.display = 'none';
            }, 2000);
        }
    }

    function updateCurrencyOptions() {
        const fromSelect = document.getElementById('fromCurrency');
        const toSelect = document.getElementById('toCurrency');

        // 清空现有选项（保留第一个默认选项）
        while (fromSelect.children.length > 1) fromSelect.removeChild(fromSelect.lastChild);
        while (toSelect.children.length > 1) toSelect.removeChild(toSelect.lastChild);

        // 添加新选项
        for (const currency in exchangeRates) {
            const option1 = document.createElement('option');
            option1.value = currency;
            option1.textContent = `${currency} (${getCurrencyName(currency)})`;

            const option2 = document.createElement('option');
            option2.value = currency;
            option2.textContent = `${currency} (${getCurrencyName(currency)})`;

            fromSelect.appendChild(option1);
            toSelect.appendChild(option2.cloneNode(true));
        }
    }

    function getCurrencyName(code) {
        const names = {
            'AED': '阿联酋迪拉姆', 'AUD': '澳元', 'BND': '文莱元', 'BRL': '巴西雷亚尔',
            'CAD': '加元', 'CHF': '瑞士法郎', 'CZK': '捷克克朗', 'DKK': '丹麦克朗',
            'EUR': '欧元', 'GBP': '英镑', 'HKD': '港元', 'HUF': '匈牙利福林',
            'IDR': '印尼卢比', 'ILS': '以色列新谢克尔', 'INR': '印度卢比', 'JPY': '日元',
            'KHR': '柬埔寨瑞尔', 'KRW': '韩元', 'KWD': '科威特第纳尔', 'MNT': '蒙古图格里克',
            'MOP': '澳门元', 'MXN': '墨西哥比索', 'NOK': '挪威克朗', 'NPR': '尼泊尔卢比',
            'NZD': '新西兰元', 'PHP': '菲律宾比索', 'PKR': '巴基斯坦卢比', 'QAR': '卡塔尔里亚尔',
            'RUB': '俄罗斯卢布', 'SAR': '沙特里亚尔', 'SEK': '瑞典克朗', 'SGD': '新加坡元',
            'THB': '泰铢', 'TRY': '土耳其里拉', 'TWD': '新台币', 'USD': '美元',
            'VND': '越南盾', 'ZAR': '南非兰特', 'CNY': '人民币'
        };
        return names[code] || code;
    }

    function convertCurrency() {
        const amount = parseFloat(document.getElementById('currencyAmount').value);
        const from = document.getElementById('fromCurrency').value;
        const to = document.getElementById('toCurrency').value;

        if (isNaN(amount)) {
            alert('请输入有效金额');
            return;
        }

        if (!exchangeRates[from] || !exchangeRates[to]) {
            alert('汇率数据未加载完成，请稍后重试');
            return;
        }

        // 汇率转换逻辑：通过人民币作为中间货币
        // 1单位from货币 = exchangeRates[from]人民币
        // 1人民币 = 1/exchangeRates[to]单位to货币
        // 所以 1单位from货币 = exchangeRates[from]/exchangeRates[to]单位to货币
        const fromRate = exchangeRates[from];
        const toRate = exchangeRates[to];
        const result = amount * (fromRate / toRate);

        document.getElementById('currencyResult').innerHTML =
            `${amount} ${from} = ${result.toFixed(4)} ${to} (汇率: 1 ${from} = ${(fromRate / toRate).toFixed(6)} ${to})`;
        document.getElementById('currencyResult').style.display = 'block';
    }

    // 房贷计算功能
    function calculateMortgage() {
        const loanAmount = parseFloat(document.getElementById('loanAmount').value);
        const annualRate = parseFloat(document.getElementById('interestRate').value);
        const loanYears = parseInt(document.getElementById('loanYears').value);
        const repaymentType = document.getElementById('repaymentType').value;

        // 输入验证
        if (isNaN(loanAmount) || loanAmount <= 0) {
            alert('请输入有效的贷款金额');
            return;
        }
        if (isNaN(annualRate) || annualRate <= 0) {
            alert('请输入有效的年利率');
            return;
        }
        if (isNaN(loanYears) || loanYears <= 0 || loanYears > 30) {
            alert('请输入有效的贷款年限（1-30年）');
            return;
        }

        const loanAmountTotal = loanAmount * 10000; // 转换为元
        const monthlyRate = annualRate / 100 / 12;
        const totalMonths = loanYears * 12;

        let monthlyPayment, totalPayment, totalInterest;

        if (repaymentType === 'equal') {
            // 等额本息计算
            monthlyPayment = (loanAmountTotal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) /
                (Math.pow(1 + monthlyRate, totalMonths) - 1);
            totalPayment = monthlyPayment * totalMonths;
        } else {
            // 等额本金计算
            const principalPerMonth = loanAmountTotal / totalMonths;
            let totalPaymentTemp = 0;
            for (let i = 0; i < totalMonths; i++) {
                const interestThisMonth = (loanAmountTotal - principalPerMonth * i) * monthlyRate;
                totalPaymentTemp += principalPerMonth + interestThisMonth;
            }
            totalPayment = totalPaymentTemp;
            monthlyPayment = (loanAmountTotal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) /
                (Math.pow(1 + monthlyRate, totalMonths) - 1); // 平均月供
        }

        totalInterest = totalPayment - loanAmountTotal;

        document.getElementById('mortgageResult').innerHTML = `
                <h3>计算结果</h3>
                <p><strong>贷款总额:</strong> ¥${loanAmountTotal.toLocaleString()}</p>
                <p><strong>还款方式:</strong> ${repaymentType === 'equal' ? '等额本息' : '等额本金'}</p>
                <p><strong>月供:</strong> ¥${monthlyPayment.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>还款总额:</strong> ¥${totalPayment.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>支付利息:</strong> ¥${totalInterest.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>还款月数:</strong> ${totalMonths} 个月</p>
            `;
        document.getElementById('mortgageResult').style.display = 'block';
    }

    // 专项扣除金额更新
    function updateDeductionAmount(id, defaultValue) {
        const checkbox = document.getElementById(id);
        const amountInput = document.getElementById(id + 'Amount');

        if (checkbox.checked) {
            amountInput.disabled = false;
            if (amountInput.value === '' || amountInput.value === '0') {
                amountInput.value = defaultValue;
            }
        } else {
            amountInput.disabled = true;
        }
    }

    // 个税计算功能
    function switchTaxMode(mode) {
        const salaryTax = document.getElementById('salaryTax');
        const bonusTax = document.getElementById('bonusTax');
        const salaryOption = document.querySelector('.tax-option:nth-child(1)');
        const bonusOption = document.querySelector('.tax-option:nth-child(2)');

        if (mode === 'salary') {
            salaryTax.style.display = 'block';
            bonusTax.style.display = 'none';
            salaryOption.classList.add('active');
            bonusOption.classList.remove('active');

            // 显示工资薪金备注，隐藏年终奖备注
            document.getElementById('salaryNotes').style.display = 'block';
            document.getElementById('bonusNotes').style.display = 'none';

            // 清除计算结果
            document.getElementById('taxResult').style.display = 'none';

            // 设置当前月份为当前月份
            const currentMonth = new Date().getMonth() + 1;
            document.getElementById('currentMonth').value = currentMonth;
        } else {
            salaryTax.style.display = 'none';
            bonusTax.style.display = 'block';
            salaryOption.classList.remove('active');
            bonusOption.classList.add('active');

            // 显示年终奖备注，隐藏工资薪金备注
            document.getElementById('salaryNotes').style.display = 'none';
            document.getElementById('bonusNotes').style.display = 'block';

            // 清除计算结果
            document.getElementById('taxResult').style.display = 'none';
        }
    }

    function calculateTax() {
        const activeTaxMode = document.querySelector('.tax-option.active').textContent.includes('工资') ? 'salary' : 'bonus';

        if (activeTaxMode === 'salary') {
            calculateSalaryTax();
        } else {
            calculateBonusTax();
        }
    }

    function calculateSalaryTax() {
        const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value);
        const currentMonth = parseInt(document.getElementById('currentMonth').value);

        // 专项附加扣除
        let deductionTotal = 0;
        if (document.getElementById('childEdu').checked) {
            deductionTotal += parseFloat(document.getElementById('childEduAmount').value) || 0;
        }
        if (document.getElementById('continueEdu').checked) {
            deductionTotal += parseFloat(document.getElementById('continueEduAmount').value) || 0;
        }
        if (document.getElementById('medical').checked) {
            const medicalAmount = parseFloat(document.getElementById('medicalAmount').value) || 0;
            deductionTotal += Math.min(medicalAmount, 80000);
        }
        if (document.getElementById('mortgageInterest').checked) {
            deductionTotal += parseFloat(document.getElementById('mortgageInterestAmount').value) || 0;
        }
        if (document.getElementById('rent').checked) {
            deductionTotal += parseFloat(document.getElementById('rentAmount').value) || 0;
        }
        if (document.getElementById('supportElderly').checked) {
            deductionTotal += parseFloat(document.getElementById('supportElderlyAmount').value) || 0;
        }
        if (document.getElementById('infantCare').checked) {
            deductionTotal += parseFloat(document.getElementById('infantCareAmount').value) || 0;
        }

        // 五险一金扣除
        const housingFundRate = parseFloat(document.getElementById('housingFundRate').value) || 0;
        const medicalRate = parseFloat(document.getElementById('medicalRate').value) || 0;
        const pensionRate = parseFloat(document.getElementById('pensionRate').value) || 0;
        const unemploymentRate = parseFloat(document.getElementById('unemploymentRate').value) || 0;
        const injuryRate = parseFloat(document.getElementById('injuryRate').value) || 0;
        const maternityRate = parseFloat(document.getElementById('maternityRate').value) || 0;

        const totalInsuranceRate = housingFundRate + medicalRate + pensionRate + unemploymentRate + injuryRate + maternityRate;
        const monthlyInsuranceDeduction = monthlyIncome * totalInsuranceRate / 100;

        // 检查输入有效性
        if (isNaN(monthlyIncome) || monthlyIncome <= 0) {
            alert('请输入有效的月收入');
            return;
        }

        if (currentMonth < 1 || currentMonth > 12) {
            alert('当前月份必须在1-12之间');
            return;
        }

        // 累计计算（当前月份的累计值）
        let cumulativeIncome = 0;
        let cumulativeInsurance = 0;
        let cumulativeDeduction = 0;
        let cumulativeThreshold = 0;

        for (let month = 1; month <= currentMonth; month++) {
            cumulativeIncome += monthlyIncome;
            cumulativeInsurance += monthlyInsuranceDeduction;
            cumulativeDeduction += deductionTotal;
            cumulativeThreshold += 5000; // 每月5000的减除费用
        }

        // 应纳税所得额 = 累计收入 - 累计五险一金 - 累计专项附加扣除 - 累计减除费用
        const cumulativeTaxableIncome = Math.max(0, cumulativeIncome - cumulativeInsurance - cumulativeDeduction - cumulativeThreshold);

        // 确定税率和速算扣除数
        let taxRate, quickDeduction;
        if (cumulativeTaxableIncome <= 36000) {
            taxRate = 0.03;
            quickDeduction = 0;
        } else if (cumulativeTaxableIncome <= 144000) {
            taxRate = 0.10;
            quickDeduction = 2520;
        } else if (cumulativeTaxableIncome <= 300000) {
            taxRate = 0.20;
            quickDeduction = 16920;
        } else if (cumulativeTaxableIncome <= 420000) {
            taxRate = 0.25;
            quickDeduction = 31920;
        } else if (cumulativeTaxableIncome <= 660000) {
            taxRate = 0.30;
            quickDeduction = 52920;
        } else if (cumulativeTaxableIncome <= 960000) {
            taxRate = 0.35;
            quickDeduction = 85920;
        } else {
            taxRate = 0.45;
            quickDeduction = 181920;
        }

        // 累计应纳税额
        const cumulativeTax = cumulativeTaxableIncome * taxRate - quickDeduction;

        // 计算当月应纳税额（需要累计已缴税额，这里假设为0或上月累计税额）
        // 简化计算：假设每月收入相同，且无前期累计税额
        // 实际应用中，cumulativeTaxPrevMonth 需要从历史记录中获取
        let cumulativeTaxPrevMonth = 0;
        for (let month = 1; month < currentMonth; month++) {
            let prevCumulativeIncome = monthlyIncome * month;
            let prevCumulativeInsurance = monthlyInsuranceDeduction * month;
            let prevCumulativeDeduction = deductionTotal * month;
            let prevCumulativeThreshold = 5000 * month;
            let prevCumulativeTaxableIncome = Math.max(0, prevCumulativeIncome - prevCumulativeInsurance - prevCumulativeDeduction - prevCumulativeThreshold);

            let prevTaxRate, prevQuickDeduction;
            if (prevCumulativeTaxableIncome <= 36000) {
                prevTaxRate = 0.03;
                prevQuickDeduction = 0;
            } else if (prevCumulativeTaxableIncome <= 144000) {
                prevTaxRate = 0.10;
                prevQuickDeduction = 2520;
            } else if (prevCumulativeTaxableIncome <= 300000) {
                prevTaxRate = 0.20;
                prevQuickDeduction = 16920;
            } else if (prevCumulativeTaxableIncome <= 420000) {
                prevTaxRate = 0.25;
                prevQuickDeduction = 31920;
            } else if (prevCumulativeTaxableIncome <= 660000) {
                prevTaxRate = 0.30;
                prevQuickDeduction = 52920;
            } else if (prevCumulativeTaxableIncome <= 960000) {
                prevTaxRate = 0.35;
                prevQuickDeduction = 85920;
            } else {
                prevTaxRate = 0.45;
                prevQuickDeduction = 181920;
            }

            cumulativeTaxPrevMonth = prevCumulativeTaxableIncome * prevTaxRate - prevQuickDeduction;
        }

        const monthlyTax = cumulativeTax - cumulativeTaxPrevMonth;
        const netIncome = monthlyIncome - monthlyTax - monthlyInsuranceDeduction;

        document.getElementById('taxResult').innerHTML = `
                <h3>工资薪金个税计算结果</h3>
                <p><strong>月收入:</strong> ¥${monthlyIncome.toLocaleString()}</p>
                <p><strong>当前月份:</strong> ${currentMonth} 月</p>
                <p><strong>专项附加扣除:</strong> ¥${deductionTotal.toLocaleString()}</p>
                <p><strong>五险一金扣除:</strong> ¥${monthlyInsuranceDeduction.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>累计收入:</strong> ¥${cumulativeIncome.toLocaleString()}</p>
                <p><strong>累计五险一金:</strong> ¥${cumulativeInsurance.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>累计专项附加扣除:</strong> ¥${cumulativeDeduction.toLocaleString()}</p>
                <p><strong>累计减除费用:</strong> ¥${cumulativeThreshold.toLocaleString()}</p>
                <p><strong>应纳税所得额(累计):</strong> ¥${cumulativeTaxableIncome.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>适用税率:</strong> ${(taxRate * 100).toFixed(1)}%</p>
                <p><strong>速算扣除数:</strong> ¥${quickDeduction.toLocaleString()}</p>
                <p><strong>累计应纳税额:</strong> ¥${cumulativeTax.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>累计已缴纳税额:</strong> ¥${cumulativeTaxPrevMonth.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>当月个税(应补税额):</strong> ¥${monthlyTax.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                <p><strong>税后收入(月):</strong> ¥${netIncome.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
            `;
        document.getElementById('taxResult').style.display = 'block';
    }

    function calculateBonusTax() {
        const annualBonus = parseFloat(document.getElementById('annualBonus').value);
        const taxMethod = document.getElementById('bonusTaxMethod').value;

        if (isNaN(annualBonus) || annualBonus <= 0) {
            alert('请输入有效的年终奖金');
            return;
        }

        let result;
        if (taxMethod === 'separate') {
            // 单独计税：年终奖金除以12个月，按月度税率表确定税率和速算扣除数
            const monthlyBonus = annualBonus / 12;
            let taxRate, quickDeduction;

            if (monthlyBonus <= 3000) {
                taxRate = 0.03;
                quickDeduction = 0;
            } else if (monthlyBonus <= 12000) {
                taxRate = 0.10;
                quickDeduction = 210;
            } else if (monthlyBonus <= 25000) {
                taxRate = 0.20;
                quickDeduction = 1410;
            } else if (monthlyBonus <= 35000) {
                taxRate = 0.25;
                quickDeduction = 2660;
            } else if (monthlyBonus <= 55000) {
                taxRate = 0.30;
                quickDeduction = 4410;
            } else if (monthlyBonus <= 80000) {
                taxRate = 0.35;
                quickDeduction = 7160;
            } else {
                taxRate = 0.45;
                quickDeduction = 15160;
            }

            const tax = annualBonus * taxRate - quickDeduction;
            const netBonus = annualBonus - tax;

            result = `
                    <h3>年终奖金个税计算结果（单独计税）</h3>
                    <p><strong>年终奖金:</strong> ¥${annualBonus.toLocaleString()}</p>
                    <p><strong>月均奖金:</strong> ¥${monthlyBonus.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                    <p><strong>适用税率:</strong> ${(taxRate * 100).toFixed(1)}%</p>
                    <p><strong>速算扣除数:</strong> ¥${quickDeduction.toLocaleString()}</p>
                    <p><strong>应缴个税:</strong> ¥${tax.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                    <p><strong>税后奖金:</strong> ¥${netBonus.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                `;
        } else {
            // 并入当年综合所得计税：需要考虑其他综合所得
            result = `
                    <h3>年终奖金个税计算结果（并入当年综合所得）</h3>
                    <p><strong>年终奖金:</strong> ¥${annualBonus.toLocaleString()}</p>
                    <p><strong>说明:</strong> 并入当年综合所得计税需要考虑全年其他综合所得，按年度税率表计算。此模式下，年终奖金将与工资薪金合并计算个税。</p>
                    <p><strong>建议:</strong> 如需精确计算，请使用工资薪金模式并输入全年收入总额。</p>
                `;
        }

        document.getElementById('taxResult').innerHTML = result;
        document.getElementById('taxResult').style.display = 'block';
    }

    // 大写数字转换
    function convertToChineseNumber() {
        const number = parseFloat(document.getElementById('numberInput').value);
        if (isNaN(number) || number < 0) {
            alert('请输入有效正数');
            return;
        }

        const result = numberToChineseAmount(number);
        document.getElementById('chineseNumberResult').innerHTML =
            `${number} = ${result}`;
        document.getElementById('chineseNumberResult').style.display = 'block';
    }

    function numberToChineseAmount(num) {
        if (num === 0) return '零元整';

        const units = ['', '拾', '佰', '仟'];
        const bigUnits = ['', '万', '亿'];
        const digits = ['零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖'];

        // 分离整数和小数部分
        const integerPart = Math.floor(num);
        const decimalPart = Math.round((num - integerPart) * 100);

        let result = '';

        // 转换整数部分
        if (integerPart > 0) {
            let numStr = integerPart.toString();
            let groupCount = 0;

            while (numStr.length > 0) {
                const group = numStr.slice(-4).padStart(4, '0');
                numStr = numStr.slice(0, -4);

                if (parseInt(group) !== 0) {
                    const groupChinese = convertFourDigitsToChinese(group, digits, units);
                    result = groupChinese + (bigUnits[groupCount] || '') + result;
                } else if (result && !result.startsWith('零')) {
                    result = '零' + result;
                }

                groupCount++;
            }

            result += '元';
        } else {
            result = '零元';
        }

        // 转换小数部分
        if (decimalPart > 0) {
            const jiao = Math.floor(decimalPart / 10);
            const fen = decimalPart % 10;

            if (jiao > 0) {
                result += digits[jiao] + '角';
            }

            if (fen > 0) {
                result += digits[fen] + '分';
            }
        } else {
            result += '整';
        }

        return result;
    }

    function convertFourDigitsToChinese(numStr, digits, units) {
        let result = '';
        let zeroCount = 0;

        for (let i = 0; i < numStr.length; i++) {
            const digit = parseInt(numStr[numStr.length - 1 - i]);
            if (digit === 0) {
                zeroCount++;
            } else {
                if (zeroCount > 0 && result) {
                    result = digits[0] + result;
                }
                if (digit !== 0 || i === 0) { // 对于个位，即使为0也要加上单位
                    result = digits[digit] + units[i] + result;
                } else if (i > 0) { // 对于非个位的0，只添加数字不添加单位
                    result = digits[digit] + result;
                }
                zeroCount = 0;
            }
        }

        // 处理特殊情况：如10 -> 壹拾，而不是壹拾零
        if (result.endsWith('零') && result !== '零') {
            result = result.slice(0, -1);
        }

        return result;
    }

    // 单位转换函数
    function convertLength() {
        const value = parseFloat(document.getElementById('lengthValue').value);
        const from = document.getElementById('lengthFrom').value;
        const to = document.getElementById('lengthTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let meters;
        switch(from) {
            case 'mm': meters = value / 1000; break;
            case 'cm': meters = value / 100; break;
            case 'm': meters = value; break;
            case 'km': meters = value * 1000; break;
            case 'in': meters = value * 0.0254; break;
            case 'ft': meters = value * 0.3048; break;
            case 'yd': meters = value * 0.9144; break;
            case 'mi': meters = value * 1609.34; break;
            default: meters = value;
        }

        let result;
        switch(to) {
            case 'mm': result = meters * 1000; break;
            case 'cm': result = meters * 100; break;
            case 'm': result = meters; break;
            case 'km': result = meters / 1000; break;
            case 'in': result = meters / 0.0254; break;
            case 'ft': result = meters / 0.3048; break;
            case 'yd': result = meters / 0.9144; break;
            case 'mi': result = meters / 1609.34; break;
            default: result = meters;
        }

        document.getElementById('lengthResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('lengthResult').style.display = 'block';
    }

    function convertArea() {
        const value = parseFloat(document.getElementById('areaValue').value);
        const from = document.getElementById('areaFrom').value;
        const to = document.getElementById('areaTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let sqmeters;
        switch(from) {
            case 'sqm': sqmeters = value; break;
            case 'sqcm': sqmeters = value / 10000; break;
            case 'sqkm': sqmeters = value * 1000000; break;
            case 'acre': sqmeters = value * 4046.86; break;
            case 'hectare': sqmeters = value * 10000; break;
            case 'sqft': sqmeters = value * 0.092903; break;
            case 'sqin': sqmeters = value * 0.00064516; break;
            default: sqmeters = value;
        }

        let result;
        switch(to) {
            case 'sqm': result = sqmeters; break;
            case 'sqcm': result = sqmeters * 10000; break;
            case 'sqkm': result = sqmeters / 1000000; break;
            case 'acre': result = sqmeters / 4046.86; break;
            case 'hectare': result = sqmeters / 10000; break;
            case 'sqft': result = sqmeters / 0.092903; break;
            case 'sqin': result = sqmeters / 0.00064516; break;
            default: result = sqmeters;
        }

        document.getElementById('areaResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('areaResult').style.display = 'block';
    }

    function convertVolume() {
        const value = parseFloat(document.getElementById('volumeValue').value);
        const from = document.getElementById('volumeFrom').value;
        const to = document.getElementById('volumeTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let liters;
        switch(from) {
            case 'ml': liters = value / 1000; break;
            case 'l': liters = value; break;
            case 'm3': liters = value * 1000; break;
            case 'gal': liters = value * 3.78541; break;
            case 'pt': liters = value * 0.473176; break;
            case 'qt': liters = value * 0.946353; break;
            default: liters = value;
        }

        let result;
        switch(to) {
            case 'ml': result = liters * 1000; break;
            case 'l': result = liters; break;
            case 'm3': result = liters / 1000; break;
            case 'gal': result = liters / 3.78541; break;
            case 'pt': result = liters / 0.473176; break;
            case 'qt': result = liters / 0.946353; break;
            default: result = liters;
        }

        document.getElementById('volumeResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('volumeResult').style.display = 'block';
    }

    function convertWeight() {
        const value = parseFloat(document.getElementById('weightValue').value);
        const from = document.getElementById('weightFrom').value;
        const to = document.getElementById('weightTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let kg;
        switch(from) {
            case 'g': kg = value / 1000; break;
            case 'kg': kg = value; break;
            case 't': kg = value * 1000; break;
            case 'lb': kg = value * 0.453592; break;
            case 'oz': kg = value * 0.0283495; break;
            case 'st': kg = value * 6.35029; break;
            default: kg = value;
        }

        let result;
        switch(to) {
            case 'g': result = kg * 1000; break;
            case 'kg': result = kg; break;
            case 't': result = kg / 1000; break;
            case 'lb': result = kg / 0.453592; break;
            case 'oz': result = kg / 0.0283495; break;
            case 'st': result = kg / 6.35029; break;
            default: result = kg;
        }

        document.getElementById('weightResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('weightResult').style.display = 'block';
    }

    function convertTemperature() {
        const value = parseFloat(document.getElementById('tempValue').value);
        const from = document.getElementById('tempFrom').value;
        const to = document.getElementById('tempTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let celsius;
        switch(from) {
            case 'celsius': celsius = value; break;
            case 'fahrenheit': celsius = (value - 32) * 5/9; break;
            case 'kelvin': celsius = value - 273.15; break;
            default: celsius = value;
        }

        let result;
        switch(to) {
            case 'celsius': result = celsius; break;
            case 'fahrenheit': result = (celsius * 9/5) + 32; break;
            case 'kelvin': result = celsius + 273.15; break;
            default: result = celsius;
        }

        document.getElementById('tempResult').innerHTML =
            `${value}° ${getUnitName(from)} = ${result.toFixed(2)}° ${getUnitName(to)}`;
        document.getElementById('tempResult').style.display = 'block';
    }

    function convertPressure() {
        const value = parseFloat(document.getElementById('pressureValue').value);
        const from = document.getElementById('pressureFrom').value;
        const to = document.getElementById('pressureTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let pa;
        switch(from) {
            case 'pa': pa = value; break;
            case 'kpa': pa = value * 1000; break;
            case 'mpa': pa = value * 1000000; break;
            case 'bar': pa = value * 100000; break;
            case 'psi': pa = value * 6894.76; break;
            case 'atm': pa = value * 101325; break;
            default: pa = value;
        }

        let result;
        switch(to) {
            case 'pa': result = pa; break;
            case 'kpa': result = pa / 1000; break;
            case 'mpa': result = pa / 1000000; break;
            case 'bar': result = pa / 100000; break;
            case 'psi': result = pa / 6894.76; break;
            case 'atm': result = pa / 101325; break;
            default: result = pa;
        }

        document.getElementById('pressureResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('pressureResult').style.display = 'block';
    }

    function convertTime() {
        const value = parseFloat(document.getElementById('timeValue').value);
        const from = document.getElementById('timeFrom').value;
        const to = document.getElementById('timeTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let seconds;
        switch(from) {
            case 'ms': seconds = value / 1000; break;
            case 's': seconds = value; break;
            case 'min': seconds = value * 60; break;
            case 'h': seconds = value * 3600; break;
            case 'd': seconds = value * 86400; break;
            case 'wk': seconds = value * 604800; break;
            case 'mo': seconds = value * 2629800; break;
            case 'y': seconds = value * 31557600; break;
            default: seconds = value;
        }

        let result;
        switch(to) {
            case 'ms': result = seconds * 1000; break;
            case 's': result = seconds; break;
            case 'min': result = seconds / 60; break;
            case 'h': result = seconds / 3600; break;
            case 'd': result = seconds / 86400; break;
            case 'wk': result = seconds / 604800; break;
            case 'mo': result = seconds / 2629800; break;
            case 'y': result = seconds / 31557600; break;
            default: result = seconds;
        }

        document.getElementById('timeResult').innerHTML =
            `${value} ${getUnitName(from)} = ${formatNumber(result)} ${getUnitName(to)}`;
        document.getElementById('timeResult').style.display = 'block';
    }

    function convertSpeed() {
        const value = parseFloat(document.getElementById('speedValue').value);
        const from = document.getElementById('speedFrom').value;
        const to = document.getElementById('speedTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let mps;
        switch(from) {
            case 'mps': mps = value; break;
            case 'kmh': mps = value / 3.6; break;
            case 'mph': mps = value * 0.44704; break;
            case 'knot': mps = value * 0.514444; break;
            default: mps = value;
        }

        let result;
        switch(to) {
            case 'mps': result = mps; break;
            case 'kmh': result = mps * 3.6; break;
            case 'mph': result = mps / 0.44704; break;
            case 'knot': result = mps / 0.514444; break;
            default: result = mps;
        }

        document.getElementById('speedResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('speedResult').style.display = 'block';
    }

    function convertPower() {
        const value = parseFloat(document.getElementById('powerValue').value);
        const from = document.getElementById('powerFrom').value;
        const to = document.getElementById('powerTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let w;
        switch(from) {
            case 'w': w = value; break;
            case 'kw': w = value * 1000; break;
            case 'hp': w = value * 745.7; break;
            case 'ps': w = value * 735.5; break;
            default: w = value;
        }

        let result;
        switch(to) {
            case 'w': result = w; break;
            case 'kw': result = w / 1000; break;
            case 'hp': result = w / 745.7; break;
            case 'ps': result = w / 735.5; break;
            default: result = w;
        }

        document.getElementById('powerResult').innerHTML =
            `${value} ${getUnitName(from)} = ${result.toFixed(6)} ${getUnitName(to)}`;
        document.getElementById('powerResult').style.display = 'block';
    }

    function convertData() {
        const value = parseFloat(document.getElementById('dataValue').value);
        const from = document.getElementById('dataFrom').value;
        const to = document.getElementById('dataTo').value;

        if (isNaN(value)) {
            alert('请输入有效数值');
            return;
        }

        let bytes;
        switch(from) {
            case 'B': bytes = value; break;
            case 'KB': bytes = value * 1024; break;
            case 'MB': bytes = value * 1024 * 1024; break;
            case 'GB': bytes = value * 1024 * 1024 * 1024; break;
            case 'TB': bytes = value * Math.pow(1024, 4); break;
            case 'PB': bytes = value * Math.pow(1024, 5); break;
            default: bytes = value;
        }

        let result;
        switch(to) {
            case 'B': result = bytes; break;
            case 'KB': result = bytes / 1024; break;
            case 'MB': result = bytes / (1024 * 1024); break;
            case 'GB': result = bytes / (1024 * 1024 * 1024); break;
            case 'TB': result = bytes / Math.pow(1024, 4); break;
            case 'PB': result = bytes / Math.pow(1024, 5); break;
            default: result = bytes;
        }

        document.getElementById('dataResult').innerHTML =
            `${value} ${getUnitName(from)} = ${formatNumber(result)} ${getUnitName(to)}`;
        document.getElementById('dataResult').style.display = 'block';
    }

    // 格式化数字，避免科学计数法
    function formatNumber(num) {
        if (Math.abs(num) < 1e-6 || Math.abs(num) > 1e15) {
            return num.toExponential(6);
        }
        if (Number.isInteger(num)) {
            return num.toString();
        }
        return num.toFixed(10).replace(/\.?0+$/, '');
    }

    function convertBase() {
        const input = document.getElementById('binaryInput').value;
        const fromBase = parseInt(document.getElementById('fromBase').value);
        const toBase = parseInt(document.getElementById('toBase').value);

        if (!input) {
            alert('请输入数值');
            return;
        }

        try {
            const decimalValue = parseInt(input, fromBase);
            if (isNaN(decimalValue)) {
                throw new Error('无效输入');
            }

            const result = decimalValue.toString(toBase).toUpperCase();

            document.getElementById('baseResult').innerHTML =
                `${input} (${fromBase}进制) = ${result} (${toBase}进制)<br>
                     十进制值: ${decimalValue}`;
            document.getElementById('baseResult').style.display = 'block';
        } catch (error) {
            alert('转换错误: ' + error.message);
        }
    }

    // BMI计算器
    function calculateBMI() {
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);

        if (isNaN(height) || isNaN(weight) || height <= 0 || weight <= 0) {
            alert('请输入有效的身高和体重');
            return;
        }

        const heightInMeters = height / 100;
        const bmi = weight / (heightInMeters * heightInMeters);
        let category;

        if (bmi < 18.5) {
            category = '偏瘦';
        } else if (bmi < 24) {
            category = '正常';
        } else if (bmi < 28) {
            category = '超重';
        } else {
            category = '肥胖';
        }

        document.getElementById('bmiResult').innerHTML = `
                <h3>BMI计算结果</h3>
                <p><strong>身高:</strong> ${height} cm</p>
                <p><strong>体重:</strong> ${weight} kg</p>
                <p><strong>BMI指数:</strong> ${bmi.toFixed(2)}</p>
                <p><strong>身体状况:</strong> ${category}</p>
            `;
        document.getElementById('bmiResult').style.display = 'block';
    }

    function getUnitName(unitCode) {
        const unitNames = {
            'mm': '毫米', 'cm': '厘米', 'm': '米', 'km': '千米',
            'in': '英寸', 'ft': '英尺', 'yd': '码', 'mi': '英里',

            'sqm': '平方米', 'sqcm': '平方厘米', 'sqkm': '平方千米',
            'acre': '英亩', 'hectare': '公顷', 'sqft': '平方英尺', 'sqin': '平方英寸',

            'g': '克', 'kg': '千克', 't': '吨', 'lb': '磅', 'oz': '盎司', 'st': '英石',

            'ml': '毫升', 'l': '升', 'm3': '立方米', 'gal': '加仑', 'pt': '品脱', 'qt': '夸脱',

            'celsius': '摄氏度', 'fahrenheit': '华氏度', 'kelvin': '开尔文',

            'B': '字节', 'KB': '千字节', 'MB': '兆字节', 'GB': '吉字节', 'TB': '太字节', 'PB': '拍字节',

            'ms': '毫秒', 's': '秒', 'min': '分钟', 'h': '小时', 'd': '天', 'wk': '周', 'mo': '月', 'y': '年',

            'mps': '米/秒', 'kmh': '千米/小时', 'mph': '英里/小时', 'knot': '节',

            'pa': '帕斯卡', 'kpa': '千帕', 'mpa': '兆帕', 'bar': '巴', 'psi': '磅/平方英寸', 'atm': '标准大气压',

            'w': '瓦特', 'kw': '千瓦', 'hp': '马力', 'ps': '公制马力'
        };
        return unitNames[unitCode] || unitCode;
    }

    function showSection(sectionId) {
        const sections = document.querySelectorAll('.calculator-section');
        sections.forEach(section => {
            section.classList.remove('active');
        });

        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(tab => {
            tab.classList.remove('active');
        });

        document.getElementById(sectionId).classList.add('active');

        const clickedElement = event ? event.target : null;
        if (clickedElement && clickedElement.classList.contains('nav-tab')) {
            clickedElement.classList.add('active');
        } else {
            const allTabs = document.querySelectorAll('.nav-tab');
            for (let tab of allTabs) {
                if (tab.textContent.includes(sectionId.charAt(0).toUpperCase() + sectionId.slice(1))) {
                    tab.classList.add('active');
                    break;
                }
            }
        }

        // 当切换到汇率页面时加载汇率数据
        if (sectionId === 'currency') {
            if (Object.keys(exchangeRates).length === 0) {
                loadExchangeRates();
            }
        }
    }

    // 页面加载时重置基本计算器历史记录
    document.addEventListener('DOMContentLoaded', function() {
        basicCalculatorHistory = [];
        document.querySelector('.nav-tab').classList.add('active');

        // 初始化时加载汇率数据
        loadExchangeRates();

        // 初始化专项扣除金额输入框状态
        updateDeductionAmount('childEdu', 2000);
        updateDeductionAmount('continueEdu', 400);
        updateDeductionAmount('medical', 0);
        updateDeductionAmount('mortgageInterest', 1000);
        updateDeductionAmount('rent', 1500);
        updateDeductionAmount('supportElderly', 2000);
        updateDeductionAmount('infantCare', 2000);

        // 设置当前月份为当前月份
        const currentMonth = new Date().getMonth() + 1;
        document.getElementById('currentMonth').value = currentMonth;
    });
</script>
</body>
</html>